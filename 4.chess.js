(self.webpackChunklogicchesseditor=self.webpackChunklogicchesseditor||[]).push([[4],{4:(e,t,s)=>{const i=s(546),n=s(364),a=s(150),o=s(753),d=s(796),r=s(972),c=s(529),h=class{constructor(){this.wrapper=i.createElement("div","box",this.speaker=i.createElement("img","speaker"),this.name=i.createElement("div","name"),i.createElement("div","status-light"),this.text=i.createElement("div","text"),this.buttons=i.createElement("div","buttons"),this.back=i.createElement("div","nav back"),this.next=i.createElement("div","nav next")),this.speaker.addEventListener("load",(()=>this.speaker.classList.remove("loading"))),this.back.addEventListener("click",this.backNode.bind(this)),this.next.addEventListener("click",this.nextNode.bind(this)),this.setNode()}get node(){return c.case.tree.items[c.node]}static speaker(e){switch(e){case"*":case"+":return"defense";case"-":return"opponent"}}static event(e){return e instanceof a?"mistake":e instanceof d?"strike":e instanceof o?"solve":void 0}setNode(){this.back.classList[this.noBack?"add":"remove"]("disabled"),this.back.classList.remove("confirm"),this.confirmBack=!1,this.next.classList.remove("disabled"),this.wrapper.classList.remove("read");const e=h.event(this.node.event);["mistake","strike","solve"].forEach((t=>this.wrapper.classList[e===t?"add":"remove"](t)));const t=h.speaker(this.node.p);["opponent","defense"].forEach((e=>this.speaker.classList[t===e?"add":"remove"](e)));const s=r.PEOPLE_IMAGES_ENDPOINT+("defense"===t?"edan":r.peopleList[c.case.tree.person])+".png";this.speaker.src!=s&&(this.speaker.classList.add("loading"),this.speaker.src=s),this.name.innerText="defense"===t?"Edgework":c.case.tree.name,this.buttons.innerHTML="",this.node.buttons.forEach((e=>{const t=i.createElement("div",`button ${e.c}`,i.createElement("div",`piece ${e.p}`),e.text);t.addEventListener("click",this.gotoNode.bind(this,e.goto)),this.buttons.append(t)})),["w","b"].forEach((e=>this.text.classList[e===this.node.c?"add":"remove"](e))),this.readText(this.node.text)}readText(e){let t=0,s=0;this.reading=!0;const i=()=>{switch(t++,e[t]){case"<":s++,t++;break;case">":s--,t++;break;case" ":t++;break;default:s>0&&t++}this.text.innerHTML=e.slice(0,t),t<e.length?this.readTimeout=setTimeout(i,50):(this.reading=!1,this.node.buttons.length&&this.wrapper.classList.add("read"),this.noNext&&this.next.classList.add("disabled"))};i()}stopRead(){return!!this.reading&&(clearTimeout(this.readTimeout),this.reading=!1,!0)}get noBack(){return c.node<=0||this.node.event instanceof a||this.node.event instanceof d}get nextNodeIndex(){return this.node.event instanceof d?this.node.event.goto:c.node+1}get noNext(){return this.nextNodeIndex>=c.case.tree.items.length||this.node.event instanceof n||this.node.event instanceof o}backNode(){if(!this.noBack){if(this.confirmBack)return this.back.classList.remove("confirm"),this.confirmBack=!1,this.stopRead(),void this.gotoNode(0);this.back.classList.add("confirm"),this.confirmBack=!0}}nextNode(){if(this.stopRead())return this.node.buttons.length&&this.wrapper.classList.add("read"),this.text.innerHTML=this.node.text,void(this.noNext&&this.next.classList.add("disabled"));this.noNext||this.gotoNode(this.nextNodeIndex)}gotoNode(e){c.node=e,this.setNode()}};e.exports=h}}]);